<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>HashMap.TreeNode类源码分析 | 翠兰 - Greenland</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.70.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="HashMap.TreeNode类源码分析" />
<meta property="og:description" content="继承关系：
 java.util.Map.Entry Map 接口中的顶层实体接口。  java.util.HashMap.Node HashMap 中的单向链表节点。  java.util.LinkedHashMap.Entry LinkedHashMap 中的双向链表节点。  java.util.HashMap.TreeNode HashMap 中的红黑树节点。         一、HashMap节点内部类 HashMap 中节点内部类有两种实现：
 链表节点：HashMap.Node 红黑树节点：HashMap.TreeNode  有关 HashMap 数据结构、方法分析、哈希冲突 及 链表实现等，见：HashMap源码分析。
 二、链表-红黑树 相互转换的方法 treeifyBin(Node, int) 方法 转换为红黑树结构：根据 hash 值计算待转换的链表在 哈希表(table) 的位置，如果否满足转换为红黑树的条件，就进行转换。
执行过程分析：
 哈希表（数组）是否已初始化：  未初始化，调用 resize() 进行初始化。 或已初始化，判断哈希表的长度是否小于 64：  小于 64，不考虑使用红黑树结构，调用 resize() 重新计算大小。 大于等于 64，转换为红黑树结构。      final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) { int n, index; Node&lt;K,V&gt; e; // 如果哈希表 tab 没有初始化，或长度小于最小 64，则 resize()  if (tab == null || (n = tab." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cuilan.github.io/posts/javase/hashmap-treenode/" />
<meta property="article:published_time" content="2019-09-11T17:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-11T17:00:00+00:00" />
<meta itemprop="name" content="HashMap.TreeNode类源码分析">
<meta itemprop="description" content="继承关系：
 java.util.Map.Entry Map 接口中的顶层实体接口。  java.util.HashMap.Node HashMap 中的单向链表节点。  java.util.LinkedHashMap.Entry LinkedHashMap 中的双向链表节点。  java.util.HashMap.TreeNode HashMap 中的红黑树节点。         一、HashMap节点内部类 HashMap 中节点内部类有两种实现：
 链表节点：HashMap.Node 红黑树节点：HashMap.TreeNode  有关 HashMap 数据结构、方法分析、哈希冲突 及 链表实现等，见：HashMap源码分析。
 二、链表-红黑树 相互转换的方法 treeifyBin(Node, int) 方法 转换为红黑树结构：根据 hash 值计算待转换的链表在 哈希表(table) 的位置，如果否满足转换为红黑树的条件，就进行转换。
执行过程分析：
 哈希表（数组）是否已初始化：  未初始化，调用 resize() 进行初始化。 或已初始化，判断哈希表的长度是否小于 64：  小于 64，不考虑使用红黑树结构，调用 resize() 重新计算大小。 大于等于 64，转换为红黑树结构。      final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) { int n, index; Node&lt;K,V&gt; e; // 如果哈希表 tab 没有初始化，或长度小于最小 64，则 resize()  if (tab == null || (n = tab.">
<meta itemprop="datePublished" content="2019-09-11T17:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-09-11T17:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1307">



<meta itemprop="keywords" content="Java,源码,集合框架," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HashMap.TreeNode类源码分析"/>
<meta name="twitter:description" content="继承关系：
 java.util.Map.Entry Map 接口中的顶层实体接口。  java.util.HashMap.Node HashMap 中的单向链表节点。  java.util.LinkedHashMap.Entry LinkedHashMap 中的双向链表节点。  java.util.HashMap.TreeNode HashMap 中的红黑树节点。         一、HashMap节点内部类 HashMap 中节点内部类有两种实现：
 链表节点：HashMap.Node 红黑树节点：HashMap.TreeNode  有关 HashMap 数据结构、方法分析、哈希冲突 及 链表实现等，见：HashMap源码分析。
 二、链表-红黑树 相互转换的方法 treeifyBin(Node, int) 方法 转换为红黑树结构：根据 hash 值计算待转换的链表在 哈希表(table) 的位置，如果否满足转换为红黑树的条件，就进行转换。
执行过程分析：
 哈希表（数组）是否已初始化：  未初始化，调用 resize() 进行初始化。 或已初始化，判断哈希表的长度是否小于 64：  小于 64，不考虑使用红黑树结构，调用 resize() 重新计算大小。 大于等于 64，转换为红黑树结构。      final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) { int n, index; Node&lt;K,V&gt; e; // 如果哈希表 tab 没有初始化，或长度小于最小 64，则 resize()  if (tab == null || (n = tab."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        翠兰 - Greenland
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://cuilan.github.io/posts/javase/hashmap-treenode/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://cuilan.github.io/posts/javase/hashmap-treenode/&amp;text=HashMap.TreeNode%e7%b1%bb%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://cuilan.github.io/posts/javase/hashmap-treenode/&amp;title=HashMap.TreeNode%e7%b1%bb%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">HashMap.TreeNode类源码分析</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2019-09-11T17:00:00Z">September 11, 2019</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>继承关系：</p>
<ul>
<li><strong><code>java.util.Map.Entry</code></strong> Map 接口中的顶层实体接口。
<ul>
<li><strong><code>java.util.HashMap.Node</code></strong> HashMap 中的单向链表节点。
<ul>
<li><strong><code>java.util.LinkedHashMap.Entry</code></strong> LinkedHashMap 中的双向链表节点。
<ul>
<li><strong><code>java.util.HashMap.TreeNode</code></strong> HashMap 中的红黑树节点。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="HashMap-TreeNode/TreeNode1.png" alt="TreeNode继承关系" title="TreeNode继承关系"></p>
<!-- raw HTML omitted -->
<hr>
<h2 id="一hashmap节点内部类">一、HashMap节点内部类</h2>
<p>HashMap 中节点内部类有两种实现：</p>
<ul>
<li>链表节点：<strong><code>HashMap.Node</code></strong></li>
<li>红黑树节点：<strong><code>HashMap.TreeNode</code></strong></li>
</ul>
<p>有关 HashMap 数据结构、方法分析、哈希冲突 及 链表实现等，见：<!-- raw HTML omitted --><strong>HashMap源码分析</strong><!-- raw HTML omitted -->。</p>
<hr>
<h2 id="二链表-红黑树-相互转换的方法">二、链表-红黑树 相互转换的方法</h2>
<h3 id="treeifybinnode-int-方法">treeifyBin(Node, int) 方法</h3>
<p>转换为红黑树结构：根据 hash 值计算待转换的链表在 哈希表(<strong><code>table</code></strong>) 的位置，如果否满足转换为红黑树的条件，就进行转换。</p>
<p><strong>执行过程分析：</strong></p>
<ul>
<li>哈希表（数组）是否已初始化：
<ul>
<li>未初始化，调用 <strong><code>resize()</code></strong> 进行初始化。</li>
<li>或已初始化，判断哈希表的长度是否小于 64：
<ul>
<li>小于 64，不考虑使用红黑树结构，调用 <strong><code>resize()</code></strong> 重新计算大小。</li>
<li>大于等于 64，转换为红黑树结构。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">treeifyBin</span><span style="color:#f92672">(</span>Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;[]</span> tab<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> hash<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> n<span style="color:#f92672">,</span> index<span style="color:#f92672">;</span> Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> e<span style="color:#f92672">;</span>
    <span style="color:#75715e">// 如果哈希表 tab 没有初始化，或长度小于最小 64，则 resize()
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tab <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">=</span> tab<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> <span style="color:#f92672">&lt;</span> MIN_TREEIFY_CAPACITY<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> resize<span style="color:#f92672">();</span> <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 根据 hash 计算哈希表的位置，并将该位置的链表转换为红黑树
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>e <span style="color:#f92672">=</span> tab<span style="color:#f92672">[</span>index <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;</span> hash<span style="color:#f92672">])</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> hd <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> tl <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 将链表节点替换为红黑树节点
</span><span style="color:#75715e"></span>            TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p <span style="color:#f92672">=</span> replacementTreeNode<span style="color:#f92672">(</span>e<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>tl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                hd <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                p<span style="color:#f92672">.</span><span style="color:#a6e22e">prev</span> <span style="color:#f92672">=</span> tl<span style="color:#f92672">;</span>
                tl<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            tl <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>e <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>tab<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> hd<span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            hd<span style="color:#f92672">.</span><span style="color:#a6e22e">treeify</span><span style="color:#f92672">(</span>tab<span style="color:#f92672">);</span> <span style="color:#75715e">// 转换为红黑树
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="newtreenodeint-k-v-node-方法">newTreeNode(int, K, V, Node) 方法</h3>
<p>创建一个新的树节点。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">newTreeNode</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> hash<span style="color:#f92672">,</span> K key<span style="color:#f92672">,</span> V value<span style="color:#f92672">,</span> Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> next<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> TreeNode<span style="color:#f92672">&lt;&gt;(</span>hash<span style="color:#f92672">,</span> key<span style="color:#f92672">,</span> value<span style="color:#f92672">,</span> next<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="replacementnodenode-node-方法">replacementNode(Node, Node) 方法</h3>
<p>将树节点转换为链表节点。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">replacementNode</span><span style="color:#f92672">(</span>Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p<span style="color:#f92672">,</span> Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> next<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Node<span style="color:#f92672">&lt;&gt;(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">hash</span><span style="color:#f92672">,</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">key</span><span style="color:#f92672">,</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">,</span> next<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="replacementtreenodenode-node-方法">replacementTreeNode(Node, Node) 方法</h3>
<p>将链表节点转换为树节点。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">replacementTreeNode</span><span style="color:#f92672">(</span>Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p<span style="color:#f92672">,</span> Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> next<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> TreeNode<span style="color:#f92672">&lt;&gt;(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">hash</span><span style="color:#f92672">,</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">key</span><span style="color:#f92672">,</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">value</span><span style="color:#f92672">,</span> next<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><hr>
<h2 id="三二叉树---font-colorred红font黑树">三、二叉树 - <!-- raw HTML omitted -->红<!-- raw HTML omitted -->黑树</h2>
<h3 id="31-二叉树">3.1 二叉树</h3>
<p><strong>二叉树</strong> 又叫二叉排序树、二叉查找树。
性能：</p>
<ul>
<li>在完全二叉树的情况下，时间复杂度为：<strong>O(logn)</strong>。</li>
<li>在极端情况下，二叉树实际上会变成链表结构，每次操作都将遍历链表，时间复杂度为：<strong>O(n)</strong>。</li>
</ul>
<p><img src="HashMap-TreeNode/BTree.png" alt="二叉树" title="二叉树"></p>
<p>二叉树的缺陷就在于不能实现<strong>自平衡</strong>。</p>
<h3 id="32-红黑树">3.2 红黑树</h3>
<p>红黑树是一种 <strong>自平衡二叉查找树</strong>，它满足 <strong>五条规则</strong>：</p>
<ul>
<li>每个节点必须是红色或黑色；</li>
<li>根节点必须是黑色；</li>
<li>每个叶子节点都是黑色的空节点；</li>
<li>如果节点是红色，则它的子节点必须是黑色（反之不一定）；</li>
<li>从根节点到叶节点或空子节点的每条路径，必须包含相同数目的黑色节点（即：<strong>相同的黑色高度</strong>）。</li>
</ul>
<p><img src="HashMap-TreeNode/RBTree.png" alt="红黑树" title="红黑树"></p>
<p>红黑树是通过 <strong>变色、<!-- raw HTML omitted -->左旋<!-- raw HTML omitted -->、<!-- raw HTML omitted -->右旋<!-- raw HTML omitted --></strong> 来保持自平衡的。</p>
<hr>
<h2 id="四treenode实现代码">四、TreeNode实现代码</h2>
<h3 id="41-成员属性">4.1 成员属性</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 继承 LinkedHashMap.Entry
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TreeNode</span><span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> LinkedHashMap<span style="color:#f92672">.</span><span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> parent<span style="color:#f92672">;</span> <span style="color:#75715e">// 链接父节点
</span><span style="color:#75715e"></span>    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> left<span style="color:#f92672">;</span> <span style="color:#75715e">// 链接左节点
</span><span style="color:#75715e"></span>    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> right<span style="color:#f92672">;</span> <span style="color:#75715e">// 链接右节点
</span><span style="color:#75715e"></span>    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> prev<span style="color:#f92672">;</span> <span style="color:#75715e">// 链接前一个节点，转换为链表时需要
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">boolean</span> red<span style="color:#f92672">;</span> <span style="color:#75715e">// 红黑树颜色
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h3 id="42-构造器">4.2 构造器</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">TreeNode<span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> hash<span style="color:#f92672">,</span> K key<span style="color:#f92672">,</span> V val<span style="color:#f92672">,</span> Node<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> next<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>hash<span style="color:#f92672">,</span> key<span style="color:#f92672">,</span> val<span style="color:#f92672">,</span> next<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="43-核心方法分析">4.3 核心方法分析</h3>
<h4 id="root-根节点">root() 根节点</h4>
<p>根节点，其父节点 parent 必须为空。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">final</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">root</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> r <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> p<span style="color:#f92672">;;)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>p <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> r<span style="color:#f92672">;</span>
        r <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="a-nameleftrotateleft-左旋a"><!-- raw HTML omitted -->rotateLeft() 左旋<!-- raw HTML omitted --></h4>
<p><img src="HashMap-TreeNode/RotateLeft.png" alt="左旋" title="左旋"></p>
<p><strong>执行过程分析：</strong></p>
<ul>
<li>p 节点不能为空，且 p 的右节点不为空，并将 p 的右节点赋值给 r。</li>
<li>如果 r 的左节点(rl) 不为空，赋值给 p 的右节点。</li>
<li>将 p 的父节点(pp) 赋值给 r 的父节点，并判断 pp 是否为空：
<ul>
<li>如果 pp 不为空，则将作为 r 的父节点。</li>
<li>如果 pp 为空，说明 r 已经是根节点，按照规则根节点一定是黑色。</li>
</ul>
</li>
<li>判断 p 节点是 pp 节点的左节点还是右节点，并赋值。</li>
<li>将 p 变更为 r 的左节点。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">rotateLeft</span><span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> root<span style="color:#f92672">,</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> r<span style="color:#f92672">,</span> pp<span style="color:#f92672">,</span> rl<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>p <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>r <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// 判断 r 的左节点是否为空
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>rl <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            rl<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>

        <span style="color:#75715e">// 是否为根节点，是否需要变色
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>pp <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">(</span>root <span style="color:#f92672">=</span> r<span style="color:#f92672">).</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

        <span style="color:#75715e">// 判断 p 是 pp 的左节点还是右节点
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span> <span style="color:#f92672">==</span> p<span style="color:#f92672">)</span>
            pp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> r<span style="color:#f92672">;</span> <span style="color:#75715e">// 左节点
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span>
            pp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> r<span style="color:#f92672">;</span> <span style="color:#75715e">// 右节点
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// 将 p 变更为 r 的左节点
</span><span style="color:#75715e"></span>        r<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
        p<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> r<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="a-namerightrotateright-右旋a"><!-- raw HTML omitted -->rotateRight() 右旋<!-- raw HTML omitted --></h4>
<p><img src="HashMap-TreeNode/RotateRight.png" alt="右旋" title="右旋"></p>
<p><strong>执行过程分析：</strong></p>
<ul>
<li>p 节点不能为空，且 p 的左节点不为空，并将 p 的左节点赋值给 l。</li>
<li>如果 l 的右节点(lr) 不为空，赋值给 p 的左节点。</li>
<li>将 p 的父节点(pp) 赋值给 l 的父节点，并判断 pp 是否为空：
<ul>
<li>如果 pp 不为空，则将作为 l 的父节点。</li>
<li>如果 pp 为空，说明 l 已经是根节点，按照规则根节点一定是黑色。</li>
</ul>
</li>
<li>判断 p 节点是 pp 节点的左节点还是右节点，并赋值。</li>
<li>将 p 变更为 l 的右节点。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">rotateRight</span><span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> root<span style="color:#f92672">,</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> l<span style="color:#f92672">,</span> pp<span style="color:#f92672">,</span> lr<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>p <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>l <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// 判断 l 的右节点是否为空
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>lr <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> l<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            lr<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>

        <span style="color:#75715e">// 是否为根节点，是否需要变色
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>pp <span style="color:#f92672">=</span> l<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">(</span>root <span style="color:#f92672">=</span> l<span style="color:#f92672">).</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

        <span style="color:#75715e">// 判断 p 是 pp 的左节点还是右节点
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span> <span style="color:#f92672">==</span> p<span style="color:#f92672">)</span>
            pp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> l<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span>
            pp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> l<span style="color:#f92672">;</span>

        <span style="color:#75715e">// 将 p 变更为 l 的右节点
</span><span style="color:#75715e"></span>        l<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
        p<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span> <span style="color:#f92672">=</span> l<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="gettreenode--find-查找">getTreeNode() &amp; find() 查找</h4>
<p>从树中查找元素，广度优先搜索。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">final</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getTreeNode</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> h<span style="color:#f92672">,</span> Object k<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">((</span>parent <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">?</span> root<span style="color:#f92672">()</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">).</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>h<span style="color:#f92672">,</span> k<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">final</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">find</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> h<span style="color:#f92672">,</span> Object k<span style="color:#f92672">,</span> Class<span style="color:#f92672">&lt;?&gt;</span> kc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> p <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> ph<span style="color:#f92672">,</span> dir<span style="color:#f92672">;</span> K pk<span style="color:#f92672">;</span>
        TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> pl <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">,</span> pr <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">,</span> q<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>ph <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">hash</span><span style="color:#f92672">)</span> <span style="color:#f92672">&gt;</span> h<span style="color:#f92672">)</span>
            p <span style="color:#f92672">=</span> pl<span style="color:#f92672">;</span> <span style="color:#75715e">// p.hash 大于 h，说明该节点在 p 的左边
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ph <span style="color:#f92672">&lt;</span> h<span style="color:#f92672">)</span>
            p <span style="color:#f92672">=</span> pr<span style="color:#f92672">;</span> <span style="color:#75715e">// p.hash 小于 h，说明该节点在 p 的右边
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>pk <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">key</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> k <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>k <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> k<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>pk<span style="color:#f92672">)))</span>
            <span style="color:#66d9ef">return</span> p<span style="color:#f92672">;</span>  <span style="color:#75715e">// p.hash 等于 h，说明该节点就是 p 节点
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            p <span style="color:#f92672">=</span> pr<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pr <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            p <span style="color:#f92672">=</span> pl<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>kc <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span>
                  <span style="color:#f92672">(</span>kc <span style="color:#f92672">=</span> comparableClassFor<span style="color:#f92672">(</span>k<span style="color:#f92672">))</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span>
                 <span style="color:#f92672">(</span>dir <span style="color:#f92672">=</span> compareComparables<span style="color:#f92672">(</span>kc<span style="color:#f92672">,</span> k<span style="color:#f92672">,</span> pk<span style="color:#f92672">))</span> <span style="color:#f92672">!=</span> 0<span style="color:#f92672">)</span>
            p <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>dir <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">?</span> pl <span style="color:#f92672">:</span> pr<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>q <span style="color:#f92672">=</span> pr<span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>h<span style="color:#f92672">,</span> k<span style="color:#f92672">,</span> kc<span style="color:#f92672">))</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> q<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span>
            p <span style="color:#f92672">=</span> pl<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>p <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="puttreeval--balanceinsertion">putTreeVal() &amp; balanceInsertion()</h4>
<p><strong><code>putTreeVal()</code></strong>：插入新树节点，通过比较决定放置在左节点还是右节点，<strong>同时维护了链表的结构</strong>。</p>
<p><strong><code>balanceInsertion()</code></strong>：平衡树的结构，<strong>变色</strong>、<strong>左旋</strong> 或 <strong>右旋</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">balanceInsertion</span><span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> root<span style="color:#f92672">,</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    x<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> xp<span style="color:#f92672">,</span> xpp<span style="color:#f92672">,</span> xppl<span style="color:#f92672">,</span> xppr<span style="color:#f92672">;;)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            x<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>xpp <span style="color:#f92672">=</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">==</span> <span style="color:#f92672">(</span>xppl <span style="color:#f92672">=</span> xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>xppr <span style="color:#f92672">=</span> xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> xppr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                xppr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                x <span style="color:#f92672">=</span> xpp<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">==</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    root <span style="color:#f92672">=</span> rotateLeft<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> x <span style="color:#f92672">=</span> xp<span style="color:#f92672">);</span>
                    xpp <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateRight<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xpp<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xppl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> xppl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                xppl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                x <span style="color:#f92672">=</span> xpp<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">==</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    root <span style="color:#f92672">=</span> rotateRight<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> x <span style="color:#f92672">=</span> xp<span style="color:#f92672">);</span>
                    xpp <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xpp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateLeft<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xpp<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="removetreenode--balancedeletion">removeTreeNode() &amp; balanceDeletion()</h4>
<p><strong><code>removeTreeNode()</code></strong>：删除节点，<strong>同时维护了链表的结构</strong>。</p>
<p><strong><code>balanceDeletion()</code></strong>：平衡树的结构，<strong>变色</strong>、<strong>左旋</strong> 或 <strong>右旋</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">balanceDeletion</span><span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> root<span style="color:#f92672">,</span>
                                           TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> xp<span style="color:#f92672">,</span> xpl<span style="color:#f92672">,</span> xpr<span style="color:#f92672">;;)</span>  <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> x <span style="color:#f92672">==</span> root<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            x<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            x<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">return</span> root<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>xpl <span style="color:#f92672">=</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>xpr <span style="color:#f92672">=</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                root <span style="color:#f92672">=</span> rotateLeft<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xp<span style="color:#f92672">);</span>
                xpr <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpr <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                x <span style="color:#f92672">=</span> xp<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> sl <span style="color:#f92672">=</span> xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">,</span> sr <span style="color:#f92672">=</span> xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>sr <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span>
                    <span style="color:#f92672">(</span>sl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                    xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                    x <span style="color:#f92672">=</span> xp<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sr <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                            sl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                        xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateRight<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xpr<span style="color:#f92672">);</span>
                        xpr <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span>
                            <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpr <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>sr <span style="color:#f92672">=</span> xpr<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                            sr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateLeft<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xp<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                    x <span style="color:#f92672">=</span> root<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// symmetric
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                root <span style="color:#f92672">=</span> rotateRight<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xp<span style="color:#f92672">);</span>
                xpl <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                x <span style="color:#f92672">=</span> xp<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                TreeNode<span style="color:#f92672">&lt;</span>K<span style="color:#f92672">,</span>V<span style="color:#f92672">&gt;</span> sl <span style="color:#f92672">=</span> xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">,</span> sr <span style="color:#f92672">=</span> xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>sl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span>
                    <span style="color:#f92672">(</span>sr <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                    xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                    x <span style="color:#f92672">=</span> xp<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sl <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>sl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>sr <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                            sr<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                        xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateLeft<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xpl<span style="color:#f92672">);</span>
                        xpl <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">parent</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span>
                            <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xpl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">:</span> xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>sl <span style="color:#f92672">=</span> xpl<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                            sl<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>xp <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        xp<span style="color:#f92672">.</span><span style="color:#a6e22e">red</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                        root <span style="color:#f92672">=</span> rotateRight<span style="color:#f92672">(</span>root<span style="color:#f92672">,</span> xp<span style="color:#f92672">);</span>
                    <span style="color:#f92672">}</span>
                    x <span style="color:#f92672">=</span> root<span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="treeify--untreeify">treeify() &amp; untreeify()</h4>
<p><strong><code>treeify()</code></strong>：由链表结构转换为红黑树结构。</p>
<p><strong><code>untreeify()</code></strong>：由红黑树结构转换为链表结构。</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/java" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Java</a>
   </li>
  
   <li class="list">
     <a href="/tags/%E6%BA%90%E7%A0%81" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">源码</a>
   </li>
  
   <li class="list">
     <a href="/tags/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">集合框架</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/javase/hashmap-source-analysis/">HashMap源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/abstractmap-source-analysis/">AbstractMap源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/navigablemap-source-analysis/">NavigableMap接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/sortedmap-source-analysis/">SortedMap接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/map-source-analysis/">Map接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/abstractqueue-source-analysis/">AbstractQueue源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/treeset-source-analysis/">TreeSet源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/linkedhashset-source-analysis/">LinkedHashSet源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/hashset-source-analysis/">HashSet源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/abstractset-source-analysis/">AbstractSet源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/abstractsequentiallist-source-analysis/">AbstractSequentialList源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/deque-source-analysis/">Deque接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/queue-source-analysis/">Queue接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/navigableset-source-analysis/">NavigableSet接口源码分析</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/javase/sortedset-source-analysis/">SortedSet接口源码分析</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://cuilan.github.io/" >
    &copy;  翠兰 - Greenland 2020 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
